{"ast":null,"code":"\"use client\";\n\nvar _jsxFileName = \"/home/muaze/mini-project/frontend/src/context/AuthContext.js\",\n  _s = $RefreshSig$();\nimport { createContext, useState, useEffect, useCallback } from \"react\";\nimport axios from \"axios\";\nimport { API_URL } from \"../config\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const AuthContext = /*#__PURE__*/createContext();\nexport const AuthProvider = ({\n  children\n}) => {\n  _s();\n  const [user, setUser] = useState(null);\n  const [accessToken, setAccessToken] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  // Initialize axios instance with interceptors\n  const axiosInstance = axios.create({\n    baseURL: API_URL,\n    withCredentials: true // Required for cookies\n  });\n\n  // Error handling function\n  const handleError = error => {\n    var _error$response, _error$response$data;\n    return ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message) || error.message || \"An error occurred\";\n  };\n\n  // Add request interceptor to add authorization token\n  axiosInstance.interceptors.request.use(config => {\n    if (accessToken) {\n      config.headers.Authorization = `Bearer ${accessToken}`;\n    }\n    return config;\n  }, error => {\n    return Promise.reject(error);\n  });\n\n  // Add response interceptor to handle token expiration and refreshing\n  axiosInstance.interceptors.response.use(response => response, async error => {\n    var _error$response2;\n    const originalRequest = error.config;\n\n    // If error is not 401 or request has already been retried, reject\n    if (((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : _error$response2.status) !== 401 || originalRequest._retry) {\n      return Promise.reject(error);\n    }\n    originalRequest._retry = true;\n    try {\n      // Try to refresh the token\n      const newAccessToken = await refreshToken();\n      originalRequest.headers.Authorization = `Bearer ${newAccessToken}`;\n      return axios(originalRequest);\n    } catch (refreshError) {\n      // If refresh fails, logout user\n      logout();\n      return Promise.reject(refreshError);\n    }\n  });\n\n  // Refresh token function\n  const refreshToken = async () => {\n    try {\n      const response = await axiosInstance.post(\"/api/auth/refresh-token\", {}, {\n        withCredentials: true\n      });\n      const {\n        accessToken: newAccessToken\n      } = response.data.data;\n      setAccessToken(newAccessToken);\n      localStorage.setItem(\"accessToken\", newAccessToken);\n      return newAccessToken;\n    } catch (error) {\n      logout();\n      return Promise.reject(error);\n    }\n  };\n\n  // Load user from storage and validate token\n  useEffect(() => {\n    const initializeAuth = async () => {\n      const storedToken = localStorage.getItem(\"accessToken\");\n      if (storedToken) {\n        setAccessToken(storedToken);\n        try {\n          const response = await axiosInstance.get(\"/api/auth/me\");\n          setUser(response.data.data.user);\n        } catch (error) {\n          // Token expired or invalid, log out\n          localStorage.removeItem(\"accessToken\");\n          setAccessToken(null);\n          setUser(null);\n        }\n      }\n      setLoading(false);\n    };\n    initializeAuth();\n  }, [axiosInstance]);\n\n  // Register user\n  const register = async userData => {\n    try {\n      setError(null);\n      const response = await axiosInstance.post(\"/api/auth/register\", userData);\n      const {\n        user,\n        accessToken\n      } = response.data.data;\n      localStorage.setItem(\"accessToken\", accessToken);\n      setAccessToken(accessToken);\n      setUser(user);\n      return user;\n    } catch (error) {\n      setError(handleError(error));\n      throw error;\n    }\n  };\n\n  // Login user\n  const login = async (email, password) => {\n    try {\n      setError(null);\n      const response = await axiosInstance.post(\"/api/auth/login\", {\n        email,\n        password\n      });\n      const {\n        user,\n        accessToken\n      } = response.data.data;\n      localStorage.setItem(\"accessToken\", accessToken);\n      setAccessToken(accessToken);\n      setUser(user);\n      return user;\n    } catch (error) {\n      setError(handleError(error));\n      throw error;\n    }\n  };\n\n  // Logout user\n  const logout = useCallback(async () => {\n    try {\n      await axiosInstance.post(\"/api/auth/logout\");\n    } catch (error) {\n      console.error(\"Logout error:\", error);\n    } finally {\n      localStorage.removeItem(\"accessToken\");\n      setAccessToken(null);\n      setUser(null);\n    }\n  }, [axiosInstance]);\n\n  // Update user profile\n  const updateProfile = async userData => {\n    try {\n      const response = await axiosInstance.put(\"/api/auth/profile\", userData);\n      setUser(response.data.data.user);\n      return response.data.data.user;\n    } catch (error) {\n      setError(handleError(error));\n      throw error;\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      user,\n      loading,\n      error,\n      register,\n      login,\n      logout,\n      updateProfile,\n      isAuthenticated: !!user,\n      axiosInstance\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 163,\n    columnNumber: 5\n  }, this);\n};\n_s(AuthProvider, \"Co/OEVEFfwP+Ok6M+VmxDbIycPo=\");\n_c = AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["_jsxFileName","_s","$RefreshSig$","createContext","useState","useEffect","useCallback","axios","API_URL","jsxDEV","_jsxDEV","AuthContext","AuthProvider","children","user","setUser","accessToken","setAccessToken","loading","setLoading","error","setError","axiosInstance","create","baseURL","withCredentials","handleError","_error$response","_error$response$data","response","data","message","interceptors","request","use","config","headers","Authorization","Promise","reject","_error$response2","originalRequest","status","_retry","newAccessToken","refreshToken","refreshError","logout","post","localStorage","setItem","initializeAuth","storedToken","getItem","get","removeItem","register","userData","login","email","password","console","updateProfile","put","Provider","value","isAuthenticated","fileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/home/muaze/mini-project/frontend/src/context/AuthContext.js"],"sourcesContent":["\"use client\"\n\nimport { createContext, useState, useEffect, useCallback } from \"react\"\nimport axios from \"axios\"\nimport { API_URL } from \"../config\"\n\nexport const AuthContext = createContext()\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null)\n  const [accessToken, setAccessToken] = useState(null)\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState(null)\n\n  // Initialize axios instance with interceptors\n  const axiosInstance = axios.create({\n    baseURL: API_URL,\n    withCredentials: true, // Required for cookies\n  })\n\n  // Error handling function\n  const handleError = (error) => {\n    return error.response?.data?.message || error.message || \"An error occurred\";\n  }\n\n  // Add request interceptor to add authorization token\n  axiosInstance.interceptors.request.use(\n    (config) => {\n      if (accessToken) {\n        config.headers.Authorization = `Bearer ${accessToken}`\n      }\n      return config\n    },\n    (error) => {\n      return Promise.reject(error)\n    },\n  )\n\n  // Add response interceptor to handle token expiration and refreshing\n  axiosInstance.interceptors.response.use(\n    (response) => response,\n    async (error) => {\n      const originalRequest = error.config\n\n      // If error is not 401 or request has already been retried, reject\n      if (error.response?.status !== 401 || originalRequest._retry) {\n        return Promise.reject(error)\n      }\n\n      originalRequest._retry = true\n\n      try {\n        // Try to refresh the token\n        const newAccessToken = await refreshToken()\n        originalRequest.headers.Authorization = `Bearer ${newAccessToken}`\n        return axios(originalRequest)\n      } catch (refreshError) {\n        // If refresh fails, logout user\n        logout()\n        return Promise.reject(refreshError)\n      }\n    },\n  )\n\n  // Refresh token function\n  const refreshToken = async () => {\n    try {\n      const response = await axiosInstance.post(\"/api/auth/refresh-token\", {}, { withCredentials: true })\n      const { accessToken: newAccessToken } = response.data.data\n      setAccessToken(newAccessToken)\n      localStorage.setItem(\"accessToken\", newAccessToken)\n      return newAccessToken\n    } catch (error) {\n      logout()\n      return Promise.reject(error)\n    }\n  }\n\n  // Load user from storage and validate token\n  useEffect(() => {\n    const initializeAuth = async () => {\n      const storedToken = localStorage.getItem(\"accessToken\")\n      if (storedToken) {\n        setAccessToken(storedToken)\n        try {\n          const response = await axiosInstance.get(\"/api/auth/me\")\n          setUser(response.data.data.user)\n        } catch (error) {\n          // Token expired or invalid, log out\n          localStorage.removeItem(\"accessToken\")\n          setAccessToken(null)\n          setUser(null)\n        }\n      }\n      setLoading(false)\n    }\n\n    initializeAuth()\n  }, [axiosInstance])\n\n  // Register user\n  const register = async (userData) => {\n    try {\n      setError(null)\n      const response = await axiosInstance.post(\"/api/auth/register\", userData)\n      const { user, accessToken } = response.data.data\n\n      localStorage.setItem(\"accessToken\", accessToken)\n      setAccessToken(accessToken)\n      setUser(user)\n\n      return user\n    } catch (error) {\n      setError(handleError(error))\n      throw error\n    }\n  }\n\n  // Login user\n  const login = async (email, password) => {\n    try {\n      setError(null)\n      const response = await axiosInstance.post(\"/api/auth/login\", { email, password })\n      const { user, accessToken } = response.data.data\n\n      localStorage.setItem(\"accessToken\", accessToken)\n      setAccessToken(accessToken)\n      setUser(user)\n\n      return user\n    } catch (error) {\n      setError(handleError(error))\n      throw error\n    }\n  }\n\n  // Logout user\n  const logout = useCallback(async () => {\n    try {\n      await axiosInstance.post(\"/api/auth/logout\")\n    } catch (error) {\n      console.error(\"Logout error:\", error)\n    } finally {\n      localStorage.removeItem(\"accessToken\")\n      setAccessToken(null)\n      setUser(null)\n    }\n  }, [axiosInstance])\n\n  // Update user profile\n  const updateProfile = async (userData) => {\n    try {\n      const response = await axiosInstance.put(\"/api/auth/profile\", userData)\n      setUser(response.data.data.user)\n      return response.data.data.user\n    } catch (error) {\n      setError(handleError(error))\n      throw error\n    }\n  }\n\n  return (\n    <AuthContext.Provider\n      value={{\n        user,\n        loading,\n        error,\n        register,\n        login,\n        logout,\n        updateProfile,\n        isAuthenticated: !!user,\n        axiosInstance,\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  )\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}